# MaintainView-OSS: サイト保守ポータル

制作会社がクライアント向けにサイトの保守状況（期限、作業ログ、次回予定）を共有するための軽量ポータルサイトです。

## v1.5 変更点
- **システム設定機能**: 管理者画面からクライアント画面の表示内容を詳細に制御できるようになりました。
  - **表示項目のON/OFF**: 契約情報、ドメイン期限、SSL期限、保守ログ、月次レポート、依頼機能、ファイル共有などを、システム全体で一括して表示/非表示に切り替え可能です。
  - **表示文言の上書き**: 「保守ログ」「依頼」「契約情報」などの主要なラベルや、依頼のステータス名（受付済み/対応中/完了）を自由に変更できます。
  - **アクセス制御**: 非表示に設定した機能は、クライアント画面からのメニュー・導線が消えるだけでなく、URL直接アクセスも制限されます（管理者は引き続き利用可能）。
  - **トップ画面のカスタマイズ**: ホーム画面のカード表示の有無を切り替えられます。

### 設定可能な項目と初期値
| 項目 (ON/OFF) | 初期値 | 説明 |
| :--- | :--- | :--- |
| 契約情報 | ON | 契約種別・期間の表示 |
| 更新予定日 | ON | サイトの次回更新日 |
| ドメイン期限 | ON | ドメイン有効期限 |
| SSL期限 | ON | SSL証明書有効期限 |
| 次回予定・注意事項 | ON | Notice機能の表示 |
| 保守ログ | ON | 作業履歴の表示 |
| 月次レポート | ON | 月次レポート出力機能 |
| 依頼機能 | ON | クライアントからのメッセージ送信 |
| 資料・ファイル | ON | ファイル共有機能 |
| トップ画面カード | ON | ホーム画面のサマリー表示 |

| ラベル上書き項目 | デフォルト値 |
| :--- | :--- |
| 保守ログ | 保守ログ |
| 作業報告 | 作業報告 |
| 次回予定 | 次回予定 |
| 注意事項 | 注意事項 |
| 契約情報 | 契約情報 |
| 更新予定日 | 更新予定日 |
| ドメイン期限 | ドメイン期限 |
| SSL期限 | 安全証明書の期限（SSL） |
| 月次レポート | 月次レポート |
| 依頼 | 依頼 |
| 資料・ファイル | 資料・ファイル |
| ステータス（新規） | 受付済み |
| ステータス（対応中） | 対応中 |
| ステータス（完了） | 完了 |

## 特徴
- **シンプル構成**: Bottle + Peewee + Jinja2 による軽量動作。
- **CGI対応**: レンタルサーバーなどのCGI環境でも動作可能。
- **SQLite採用**: 外部DB不要、ファイル一つで完結。
- **セキュリティ**: パスワードハッシュ化(PBKDF2)、CSRF対策、ロール別認可。

## 導入手順

### 1. 依存ライブラリのインストール
```bash
pip install -r requirements.txt
```

### 2. 設定の確認
`settings.py` を開き、必要に応じて以下の項目を変更してください。
- `SECRET_KEY`: セッション署名用の秘密鍵（必ず変更してください）
- `DEFAULT_ADMIN_PASSWORD`: 初回起動時の管理者パスワード
- `IS_CGI`: CGI環境で動かす場合は `True` に設定

### 3. 起動
#### 開発サーバー
```bash
python index.py
```
`http://localhost:8080` にアクセスしてください。

## セキュリティについて
- **パスワード**: PBKDF2でハッシュ化されます。初期パスワードはログイン後すぐに変更してください。
- **CSRF対策**: すべてのPOST操作でCSRFトークンチェックを行っています。
- **認可制御**: クライアントユーザーは自社に所属するデータのみ閲覧可能です。直URLアクセスも制限されています。
- **ファイル配信**: 実ファイルパスを隠蔽し、署名付きトークンによる権限チェック付きで配信します。

## 既知の制限・今後の予定
- メール通知機能はありません（v1.6以降検討）。
- 外部API連携や監視自動化機能はありません。
- データのバックアップは `maintenance.db` ファイルをコピーすることで行えます。

## ライセンス
AGPL-3.0
